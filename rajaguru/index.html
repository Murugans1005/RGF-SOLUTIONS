<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAJAGURU CMS v18 - Final Calculation</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; margin: 0; padding: 10px; }
        .container { max-width: 950px; margin: auto; display: none; }
        #loginPage { max-width: 350px; margin: 80px auto; background: white; padding: 40px; border-radius: 20px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-top: 8px solid #d32f2f; }
        .login-input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .header { background: #d32f2f; color: white; padding: 15px; text-align: center; border-radius: 12px; margin-bottom: 15px; }
        .summary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
        .s-card { background: white; padding: 12px; border-radius: 10px; text-align: center; border-bottom: 3px solid #d32f2f; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .s-card p { margin:5px 0 0; font-weight:bold; font-size:15px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-top: 10px; font-size: 13px; color: #555; }
        input { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; color: white; margin-top: 10px; }
        .btn-save { background: #2e7d32; }
        .btn-admin { background: #1a237e; }
        #adminView { display: none; }
        table { width: 100%; border-collapse: collapse; font-size: 11px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: center; }
        th { background: #1a237e; color: white; }
        .month-header { background: #f5f5f5; font-weight: bold; color: #d32f2f; }
    </style>
</head>
<body>

<div id="loginPage">
    <h2>RGF LOGIN</h2>
    <input type="text" id="username" class="login-input" placeholder="User ID">
    <input type="password" id="password" class="login-input" placeholder="Password">
    <button class="btn btn-save" onclick="handleLogin()">LOGIN</button>
</div>

<div class="container" id="mainApp">
    <div class="header"><h2>RAJAGURU CMS v18</h2></div>
    
    <div class="summary-grid">
        <div class="s-card"><h4>BOM BAL</h4><p id="sumB1">â‚¹0</p></div>
        <div class="s-card"><h4>AIRTEL BAL</h4><p id="sumB2">â‚¹0</p></div>
        <div class="s-card"><h4>PANDI ID BAL</h4><p id="sumB3" style="color:#d32f2f;">â‚¹0</p></div>
    </div>

    <div id="entrySection">
        <div class="card">
            <h3 style="margin:0; color:#d32f2f;">New Transaction</h3>
            <label>Date</label><input type="date" id="date" value="2026-01-11">
            
            <label>Airtel âž” Pandi (Load)</label>
            <input type="number" id="a2p" placeholder="Enter Load">
            
            <label>Pandi Return Amount (Cash/Gpay)</label>
            <input type="number" id="p2h" placeholder="Enter Return">
            
            <label>BOM âž” Airtel (Transfer)</label>
            <input type="number" id="h2a" placeholder="Enter BOM Ref">
            
            <button class="btn btn-save" onclick="save()">SAVE TRANSACTION</button>
            <button class="btn btn-admin" onclick="showAdmin()">ðŸ“Š VIEW FILTERED REPORTS âž”</button>
        </div>
    </div>

    <div id="adminView">
        <div class="card">
            <h3 style="margin:0 0 10px 0;">Transaction History</h3>
            <div style="overflow-x:auto;">
                <table>
                    <thead><tr><th>Date</th><th>Load</th><th>Return</th><th>Entry Bal</th><th>Run. ID Bal</th></tr></thead>
                    <tbody id="reportTbody"></tbody>
                </table>
            </div>
            <button class="btn" style="background:#757575;" onclick="showEntry()">â¬… Back to Entry</button>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCTfzmnIMbryZuGCm4iq_3C1vrjQk4BWF4",
        authDomain: "rgf-solutions.firebaseapp.com",
        databaseURL: "https://rgf-solutions-default-rtdb.firebaseio.com",
        projectId: "rgf-solutions",
        storageBucket: "rgf-solutions.firebasestorage.app",
        messagingSenderId: "324475817892",
        appId: "1:324475817892:web:103ecc2311e6b459f4fb31"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function handleLogin() {
        if(document.getElementById('username').value === "SMurugan" && document.getElementById('password').value === "Manager") {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            loadReport();
        } else { alert("Error!"); }
    }

    function save() {
        const a2p = parseFloat(document.getElementById('a2p').value) || 0;
        const p2h = parseFloat(document.getElementById('p2h').value) || 0;
        const data = {
            date: document.getElementById('date').value,
            a2p: a2p, p2h: p2h, h2a: parseFloat(document.getElementById('h2a').value) || 0,
            diff: (a2p - p2h) // Indha specific entry-oda balance
        };
        db.ref('rajaguru_tracker').push(data).then(() => { alert("Saved!"); location.reload(); });
    }

    function loadReport() {
        db.ref('rajaguru_tracker').on('value', snap => {
            const tbody = document.getElementById('reportTbody');
            tbody.innerHTML = "";
            let b1=0, b2=0, b3=0; // Overall Balances
            let runningIdBal = 0; // Cumulative Pandi ID Balance

            snap.forEach(c => {
                const v = c.val();
                // Kanakku Logic:
                b1 += (v.p2h - v.h2a); // BOM Account balance
                b2 += (v.h2a - v.a2p); // Airtel Account balance
                b3 += (v.a2p - v.p2h); // Pandi ID balance (Running)
                
                runningIdBal += (v.a2p - v.p2h);

                tbody.innerHTML = `<tr>
                    <td>${v.date}</td><td>${v.a2p}</td><td>${v.p2h}</td><td>${v.a2p - v.p2h}</td><td><b>${runningIdBal}</b></td>
                </tr>` + tbody.innerHTML;
            });

            document.getElementById('sumB1').innerText = "â‚¹" + b1.toLocaleString();
            document.getElementById('sumB2').innerText = "â‚¹" + b2.toLocaleString();
            document.getElementById('sumB3').innerText = "â‚¹" + b3.toLocaleString();
        });
    }

    function showAdmin() { document.getElementById('entrySection').style.display='none'; document.getElementById('adminView').style.display='block'; }
    function showEntry() { document.getElementById('entrySection').style.display='block'; document.getElementById('adminView').style.display='none'; }
</script>
</body>
</html>
