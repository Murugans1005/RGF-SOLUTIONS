<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAJAGURU CMS v26 - Login Fixed</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; padding: 10px; }
        .container { max-width: 900px; margin: auto; display: none; }
        #loginPage { max-width: 350px; margin: 80px auto; background: white; padding: 30px; border-radius: 20px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-top: 8px solid #d32f2f; }
        .login-input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; outline: none; }
        .header { background: #d32f2f; color: white; padding: 15px; text-align: center; border-radius: 12px; margin-bottom: 10px; }
        .summary-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px; }
        .s-card { background: white; padding: 10px; border-radius: 10px; text-align: center; border-top: 4px solid #d32f2f; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .s-card p { margin: 5px 0 0; font-weight: bold; font-size: 14px; }
        .cih-card { background: #fff9c4; border-top: 4px solid #fbc02d; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 20px; border-left: 6px solid #d32f2f; }
        label { display: block; font-weight: bold; margin-top: 10px; font-size: 13px; color: #555; }
        input, select { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 15px; }
        .btn { width: 100%; padding: 16px; border: none; border-radius: 10px; font-size: 17px; font-weight: bold; cursor: pointer; color: white; margin-top: 12px; }
        .btn-save { background: #2e7d32; }
        .btn-wa { background: #25D366; }
        .btn-admin { background: #1a237e; }
        #adminView { display: none; margin-top: 20px; background: white; padding: 20px; border-radius: 15px; }
        table { width: 100%; border-collapse: collapse; font-size: 10px; }
        th, td { border: 1px solid #eee; padding: 8px; text-align: center; }
        th { background: #1a237e; color: white; }
    </style>
</head>
<body>

<div id="loginPage">
    <h2 style="color:#d32f2f;">RAJAGURU LOGIN</h2>
    <input type="text" id="username" class="login-input" placeholder="User ID (eg: m)">
    <input type="password" id="password" class="login-input" placeholder="Password (eg: m)">
    <button class="btn btn-save" onclick="handleLogin()">ENTER APP</button>
</div>

<div class="container" id="mainApp">
    <div class="header"><h2 style="margin:0;">RAJAGURU TRACKER v26</h2></div>
    
    <div class="summary-grid">
        <div class="s-card"><h4>BOM BAL</h4><p id="sumB1">‚Çπ0</p></div>
        <div class="s-card"><h4>AIRTEL BAL</h4><p id="sumB2">‚Çπ0</p></div>
        <div class="s-card"><h4>PANDI ID</h4><p id="sumB3">‚Çπ0</p></div>
        <div class="s-card cih-card"><h4>CASH IN HAND</h4><p id="sumCIH" style="color:#d32f2f;">‚Çπ0</p></div>
    </div>

    <div id="entrySection">
        <div class="card">
            <h3 style="margin:0; color:#d32f2f;">New Transaction</h3>
            <input type="hidden" id="editId">
            <div style="display:flex; gap:10px;">
                <div style="flex:1;"><label>Date</label><input type="date" id="date"></div>
                <div style="flex:1;"><label>Time</label><input type="time" id="time"></div>
            </div>
            
            <label>1. BOM ‚ûî Airtel Load (-)</label><input type="number" id="h2a">
            <label>2. Airtel ‚ûî Pandi Load (-)</label><input type="number" id="a2p" oninput="runLogic()">
            <label>3. Pandi Return Amount (+)</label>
            <div style="display:flex; gap:10px;">
                <input type="number" id="p2h" oninput="runLogic()">
                <select id="mode"><option value="Cash">Cash</option><option value="Gpay">Gpay</option><option value="Account">Account</option></select>
            </div>
            <label>4. Bank Deposit (CIH ‚ûî Bank)</label><input type="number" id="bomDeposit">

            <div style="background:#e3f2fd; padding:15px; margin-top:15px; border-radius:10px; text-align:center;">
                Pandi Balance: <strong style="color:#d32f2f;">‚Çπ<span id="pandiIdBal">0</span></strong>
            </div>
            
            <button class="btn btn-save" onclick="save()">SAVE DATA</button>
            <button class="btn btn-wa" onclick="shareToGroup()">SHARE WHATSAPP</button>
            <button class="btn btn-admin" onclick="goToAdmin()">HISTORY ‚ûî</button>
        </div>
    </div>

    <div id="adminView">
        <div class="card">
            <h3 style="margin:0 0 10px 0;">History</h3>
            <div style="overflow-x:auto;">
                <table>
                    <thead><tr><th>Date</th><th>A2P</th><th>P2H</th><th>Dep</th><th>ID Bal</th><th>Act</th></tr></thead>
                    <tbody id="reportTbody"></tbody>
                </table>
            </div>
            <button class="btn" style="background:#757575;" onclick="goToEntry()">‚¨Ö Back</button>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCTfzmnIMbryZuGCm4iq_3C1vrjQk4BWF4",
        authDomain: "rgf-solutions.firebaseapp.com",
        databaseURL: "https://rgf-solutions-default-rtdb.firebaseio.com",
        projectId: "rgf-solutions",
        storageBucket: "rgf-solutions.firebasestorage.app",
        messagingSenderId: "324475817892",
        appId: "1:324475817892:web:103ecc2311e6b459f4fb31"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // LOGIN FIX: Just type 'm' in both fields to enter
    function handleLogin() {
        const u = document.getElementById('username').value.toLowerCase().trim();
        const p = document.getElementById('password').toLowerCase().trim();
        
        if(u === "murugan" && p === "murugan") {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            loadReport();
        } else { alert("Login Failed Mapla! Type 'murugan' in both fields."); }
    }

    document.getElementById('date').value = new Date().toISOString().split('T')[0];
    document.getElementById('time').value = new Date().toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'});

    function runLogic() {
        const load = Number(document.getElementById('a2p').value) || 0;
        const ret = Number(document.getElementById('p2h').value) || 0;
        document.getElementById('pandiIdBal').innerText = (load - ret).toFixed(2);
    }

    function save() {
        const id = document.getElementById('editId').value || Date.now().toString();
        const data = {
            date: document.getElementById('date').value, 
            time: document.getElementById('time').value,
            h2a: Number(document.getElementById('h2a').value) || 0,
            a2p: Number(document.getElementById('a2p').value) || 0, 
            p2h: Number(document.getElementById('p2h').value) || 0,
            bomDep: Number(document.getElementById('bomDeposit').value) || 0,
            mode: document.getElementById('mode').value
        };
        db.ref('rajaguru_tracker/' + id).set(data).then(() => { alert("Saved!"); location.reload(); });
    }

    function loadReport() {
        db.ref('rajaguru_tracker').on('value', snap => {
            const tbody = document.getElementById('reportTbody'); tbody.innerHTML = "";
            let b1=0, b2=0, b3=0, cih=0, runId=0; 
            const all = snap.val() || {};
            Object.keys(all).sort().forEach(key => {
                const v = all[key];
                const h2a=Number(v.h2a), a2p=Number(v.a2p), p2h=Number(v.p2h), dep=Number(v.bomDep);
                b1 += (dep-h2a); b2 += (h2a-a2p); b3 += (a2p-p2h); runId += (a2p-p2h);
                if(v.mode === "Cash") { cih += p2h; } cih -= dep;
                tbody.innerHTML = `<tr><td>${v.date}</td><td>${a2p}</td><td>${p2h}</td><td>${dep}</td><td>${runId}</td><td><span onclick="db.ref('rajaguru_tracker/${key}').remove()">‚ùå</span></td></tr>` + tbody.innerHTML;
            });
            document.getElementById('sumB1').innerText = "‚Çπ"+b1;
            document.getElementById('sumB2').innerText = "‚Çπ"+b2;
            document.getElementById('sumB3').innerText = "‚Çπ"+b3;
            document.getElementById('sumCIH').innerText = "‚Çπ"+cih;
        });
    }

    function goToAdmin() { document.getElementById('entrySection').style.display='none'; document.getElementById('adminView').style.display='block'; }
    function goToEntry() { document.getElementById('entrySection').style.display='block'; document.getElementById('adminView').style.display='none'; }
    function shareToGroup() {
        const msg = `*üìä RAJAGURU REPORT*\nüìÖ *Date:* ${document.getElementById('date').value}\nüì± *Load:* ‚Çπ${document.getElementById('a2p').value}\nüíµ *Ret:* ‚Çπ${document.getElementById('p2h').value}\nüí∞ *CIH:* ${document.getElementById('sumCIH').innerText}`;
        window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(msg)}`, '_blank');
    }
</script>
</body>
</html>
